信息源消息处理流程



信息源：

```
{
"type":"0",

"pic":[{"url":"http://myr.mkstone.club/1EE56E4FB079B8887F7985F4549D4FE6.jpg"}],

"msg":"【京东自营】高洁丝Kotex臻选澳洲进口纯棉0.08极薄350mm4片#https://u.jd.com/zt9Agr#报价：12.9元/件，加购物车2件，修改促销方式为满2件打5折，下单拍2件12.9元，折6.45元/件，阳光进口绵，柔软亲肤，舒爽透气",

"category":"0"
}


```

| 参数| 类型    |  请求参数参考值  | 
| --------   | -----:   | :----: |
| type      | String      |  0    |
| pic       | String[]    |  [{"url":"http://myr.mkstone.club/1EE56E4FB079B8887F7985F4549D4FE6.jpg"}]   |
| msg        | String      |   【京东自营】高洁丝Kotex臻选澳洲进口纯棉0.08极薄350mm4片#https://u.jd.com/zt9Agr#报价：12.9元/件，加购物车2件，修改促销方式为满2件打5折，下单拍2件12.9元，折6.45元/件，阳光进口绵，柔软亲肤，舒爽透气    |
| category        | String      |   0    |


### 说明

```
type ： “0”-京东数据源，“1”-淘宝数据源，“2”-苏宁数据源， “3”-羊毛数据源， “4”-机酒数据源， “5”-京东宝妈主题数据源， “6”-京东学生主题数据源

pic：图片URL，可能为多个或者空

msg：消息主体，#为换行符

category：“0”-车消息， “1”-直播消息

```

type字段，根据用户选择的配置，来确定用户需要哪几个数据源。





	![baidu](http://static.jshangpin.com/QQ%E6%88%AA%E5%9B%BE20200102000626.png "百度logo")






## 京东即 type=0,5,6：

### type=0,5,6 的处理流程 






#### category字段

category=0时，车消息，车消息需要转链。

category=1时，直播消息，直播消息不需要转链。 如果用户选择发送直播消息，才发送。
   
#### msg字段
category=0时,走转链逻辑。

category=1时，走直播消息逻辑。

##### 直播消息逻辑
 如果用户选择发送直播消息，才发送。

##### 转链逻辑

提取msg中的url，遍历url
```
{ 
走转链接口，用转链好的链接替换原链接
如果url含有“coupon”字符串，则不转链，保留链接。
如果转链失败，接口返回的字段是空，则保留原链接。
}
```

### pic字段
如果用户选择发图，就下载，发送图片

如果用户选择先发图，再发消息，加入消息队列，图发出去再发文字消息

如果用户选择不发图，不处理


## 苏宁即 type=2：









# 最后的消息总处理流程
## 关键词替换
替换msg字段的内容，根据用户配置来检测替换。

## 小尾巴
再msg字段的内容加上小尾巴，小尾巴来自用户配置


